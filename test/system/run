#!/bin/bash
if command -v md5sum &>/dev/null
then
    compare=md5sum
elif command -v md5 &>/dev/null
then
    compare=md5
else
    echo "Need md5 or md5sum to compare. File a bug"
    exit 1
fi
cd $(dirname $0)
for i in $(find . -name "*.cmd" -print | sort)
do
    base=$(basename $i .cmd)
    got=$(. $i < ${base}.in | ${compare})
    want=$(cat ${base}.out | ${compare})
    if [ "${want}" != "${got}" ]
    then
        echo FAILURE: ${base}
        cat ${base}.cmd
        . $i < ${base}.in
        exit 1
    else
        echo SUCCESS: ${base}
    fi
done
